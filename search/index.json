[{"content":"饥荒联机版服务器搭建 一、环境准备 1.1 硬件准备 虽然近日因为AI计算浪潮，内存条几乎翻倍猛涨，但我仍然狠下心买了一台迷你主机，配置如下（16G内存），之前发售的时候也不过1500左右，现在要足足2099，还是在有国补的情况下。考虑到配置比较低，系统我决定使用Ubuntu Server版本，虽然有核显，但单纯做服务器确实没必要搞图形化界面浪费性能，目前打算是开1-2个档就够了，主要比较关心一个档能支持多少人，这个我不太清楚怎么根据配置计算，只有一步步看了。\n实物图我放在了下面，手掌大小，非常小巧，我主要看重的是它宣传的运行噪音低于32dB，适合直接放在卧室。\n服务器主机准备好了，再找一个做启动盘的U盘配合我以前的台式主机就可以开始了。\n1.2 软件环境准备 软件环境主要就是启动盘的制作了，首先到ubuntu.com官网下载最新的镜像，我下载的是ubuntu-24.04.3-live-server-amd64.iso，然后到rufus.ie官网下载启动盘制作工具Rufus并打开，引导类型选择刚刚下载的镜像，分区类型选择GPT，目标系统类型选择UEFI，2012年后的主机基本都是GPT+UEFI了，如果是上古时代的宝贝需要选择其他类型，其他默认即可，点击开始等待准备就绪进度条全绿后即可关闭退出。\n注意：请备份U盘数据，该操作会格式化整个U盘！！！\n二、 操作系统安装与远程访问 2.1 Ubuntu-Server安装 第一步：\n将准备好的启动盘插在迷你主机上，进入BIOS模式选择对应的启动盘启动，我这主机是按F7进入BIOS，一般开机界面会打印进入BIOS的按键的。\n第二步：\n安装配置，这里有个非常详细的教程，按这个来就可以了zhuanlan.zhihu.com，网络连接因为暂时没内网环境我先连的手机热点，后续再修改，组件就和教程一样只安装了一个SSH，其他的搭建简单的服务器也用不上。\n第三步：\n重启查看系统是否正常，检查一下内存使用情况，磁盘分区，看看CPU占用率这些基础的硬件状态，一切正常\n1 2 3 top #查看进程状态，包含CPU和内存信息，按q退出 df -h #查看磁盘状态，因为默认只分了100G，还有300多G在LVM里面没有划分，这里看不到 free -h #查看内存状态，有4GB的交换空间，如果内存溢出会从硬盘搞4GB的空间来临时使用，避免直接崩溃 2.2 内网WIFI连接 之前安装的时候连的手机热点，现在需要进入内网环境，需要修改一下配置\n1 2 3 4 5 6 7 ls /etc/netplan/ #查看一下该目录下的配置文件 #建议执行下面的操作备份一下文件 sudo cp /etc/netplan/你的配置文件.yaml /etc/netplan/你的配置文件.yaml.backup sudo nano /etc/netplan/你的配置文件.yaml #用nano打开这个网络配置文件，nano是编辑器，窗口底下会显示所有操作命令 #因为添加的还是wifi所以按照本来手机热点的格式添加一个配置就行了，更换一下WIFI名称和密码就可以了 修改完后点击ctrl+x退出y保存，enter确认即可。\n1 2 sudo netplan apply #应用修改后的最新配置 hostname -I #查看当前IP，如果有就说明连接上了，可以通过电脑远程访问了 配置启动SSH，下面是其常用指令，这里直接启动然后看状态处于active就可以了（开机自启一般需要设置）。\n1 2 3 4 5 6 sudo systemctl status ssh\t#查运行状态 sudo systemctl start ssh\t#启动SSH服务\tsudo systemctl stop ssh\t#停止SSH服务\tsudo systemctl restart ssh\t#重启SSH服务\tsudo systemctl enable ssh\t#设置开机自启\tsudo systemctl disable ssh\t#禁用开机自启\t2.3 SSH远程访问 如果在电脑上也能ping通服务器的IP，那就可以拔掉服务器的显示屏和键盘了，我显示屏支持分屏显示还好，主机用DP接口，迷你主机用HDMI接口可以一起使用，但键盘只有一个只能反复切换很麻烦，所以还是远程登陆比较方便。\n回到Windows的主机，打开CMD，开始远程访问：\n1 2 #第一次连接时，客户端会询问你是否信任该主机，输入yes并回车即可 ssh 你的服务器用户名@服务器的IP地址 #会提示输入账号和密码，看到和之前在服务器上一样的前缀提示符就说明成功了 三、 局域网服务器搭建 服务器首先当然要解决公网问题，现在我的路由器没给IPV4的公网IP，需要借助其他手段比如内网穿透，代理之类的，但最靠谱的还是直接向运营商要一个公网IP，这里因为我还有两个月就搬家的原因，决定先试试局域网，后面搬家后再找运营商要一个公网IP。\n3.1 更新软件源和安装依赖 1 2 3 4 5 6 7 8 9 10 11 12 13 #启用Ubuntu系统上的“multiverse”（多元宇宙）软件源仓库 sudo add-apt-repository multiverse #在64位的Ubuntu系统上，添加对32位(i386)软件包架构的支持 sudo dpkg --add-architecture i386 #刷新本地的软件包索引列表，使其与当前已启用的所有软件源 sudo apt-get -y update #安装依赖 sudo apt install -y screen wget unzip sudo apt-get -y install lib32gcc-s1 libstdc++6:i386 libgcc1:i386 libcurl4-gnutls-dev:i386 #screen：终端复用器。它允许你在一个SSH连接中创建多个持久的虚拟终端会话。当你关闭SSH窗口后，在 screen 会话中运行的程序（如饥荒服务器）会继续在后台执行。这是管理长时间运行服务的必备工具。 #wget unzip：下载工具和解压工具 #lib32gcc-s1 libstdc++6:i386 libgcc1:i386 libcurl4-gnutls-dev:i386：32位运行库，SteamCMD和很多游戏服务器程序是32位的，我的服务器是64位的 安装依赖的时候出现报错了，根据报错信息分析，这里很奇怪，我没有换过镜像源，安装的时候默认配置是cn.archive.ubuntu.com（Ubuntu官方为中国大陆提供的官方镜像）和 security.ubuntu.com，根本没有tuna清华的源，不知道怎么跑这里去了，而且403错误代码是版本号对不上，查询我的版本为noble即24.04，没搞懂，但换阿里的源就正常了。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #报错信息：E: Failed to fetch http://mirrors.tuna.tsinghua.edu.cn/ubuntu/pool/main/p/p11-kit/libp11-kit0_0.25.3-4ubuntu2.1_i386.deb 403 Forbidden [IP: 2402:f000:1:400::2 80] #系统版本查询 lsb_release -c #备份镜像源配置 sudo cp /etc/apt/sources.list /etc/apt/sources.list.backup #更换阿里的镜像源 sudo tee /etc/apt/sources.list \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; deb https://mirrors.aliyun.com/ubuntu/ noble main restricted universe multiverse deb https://mirrors.aliyun.com/ubuntu/ noble-updates main restricted universe multiverse deb https://mirrors.aliyun.com/ubuntu/ noble-security main restricted universe multiverse deb https://mirrors.aliyun.com/ubuntu/ noble-backports main restricted universe multiverse EOF #更新 sudo apt-get update #重新安装依赖 sudo apt install -y screen wget unzip sudo apt-get -y install lib32gcc-s1 libstdc++6:i386 libgcc1:i386 libcurl4-gnutls-dev:i386 安装成功了，这时候我们打开sources.list.backup会发现:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # Ubuntu sources have moved to /etc/apt/sources.list.d/ubuntu.sources #原来这是24.04的新特性，该版本默认启用了全新的“Deb822-style”源格式，替代了已使用二十多年的传统 sources.list格式 #然后我们继续打开sources文件，显示如下： Types: deb URIs: http://cn.archive.ubuntu.com/ubuntu/ Suites: noble noble-updates noble-backports Components: main restricted universe multiverse Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg Types: deb URIs: http://security.ubuntu.com/ubuntu/ Suites: noble-security Components: main restricted universe multiverse Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg #我们之前换源是在list下操作的，所以这个source文件没有更改过，这里面默认就是官方的源，不知道清华的源哪里来的，而且清华的源为什么会报错，阿里就不会 虽然现在能跑，但毕竟刚刚换源用的老方法修改list，还是换成新特性修改吧：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 #打开sources文件 sudo nano /etc/apt/sources.list.d/ubuntu.sources #添加如下文本并保存(前面两个官方的源可全部注释掉) Types: deb URIs: https://mirrors.aliyun.com/ubuntu/ Suites: noble noble-updates noble-security noble-backports Components: main restricted universe multiverse Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg #打开刚刚的list文件并全部注释，每行前面加“#” sudo nano /etc/apt/sources.list #更新源 sudo apt-get update 卧槽，看我发现了啥，出现了清华的源，我刚刚是在sources文件后面原配置添加的阿里的源，没有注释，也就说这前面官方源配置莫名奇妙跑到清华源去了，造成了后续的403报错，我将两个官方源都注释了，再更新就没有添加清华源了，更能证明这一点。阿里源本来就同步了这两个官方源的，保留阿里源就够了，我暂时就不再深究了后续熟悉APT后有机会再来看看。\n3.2 饥荒服务器环境安装 第一步：steamcmd安装\n1 2 3 4 5 6 7 8 9 10 #回到主目录并创建饥荒服务器专用目录 cd ~ mkdir -p dst-server/steamcmd #下载并解压steamcmd程序，这是直接去steam官方下载最新版，没有用APT cd ~/dst-server/steamcmd/ curl -sqL \u0026#34;https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz\u0026#34; | tar zxvf - #运行，完成后自动退出 ./steamcmd.sh +quit 安装完成后目录如下图所示：\n第二步：饥荒联机版服务端安装\n1 2 3 4 5 6 7 8 9 10 11 12 #回到主目录并创建饥荒游戏专用目录 cd ~ mkdir -p dst-server/dontstarve #使用steamcmd下载饥荒联机版服务端 ~/dst-server/steamcmd/steamcmd.sh +force_install_dir ~/dst-server/dontstarve +login anonymous +app_update 343050 validate +quit #报错：ERROR! Failed to install app \u0026#39;343050\u0026#39; (Missing configuration) #可能是安装时记录的配置与现在执行有误，删除配置文件重新下载 pkill -f steamcmd rm -rf ~/.steam ~/Steam ~/dst-server/steamcmd/steamcmd.sh +force_install_dir ~/dst-server/dontstarve +login anonymous +app_update 343050 validate +quit 成功安装打印如下：\n3.3 服务器配置 运行服务器，需要游戏官方的token，进行授权，访问科雷官网：Klei，使用steam账户登陆，选择游戏\u0026raquo;《饥荒：联机版》的游戏服务器，输入服务器名称后点击添加新服务器：\n服务器生成后点击配置服务器，按照你的想法配置好后点击下载设置，下载完成后，得到一个名为MyDediServer.zip的压缩文件。\n1 2 3 #创建游戏配置文件夹 cd ~ mkdir -p dst-server/dontstarve-config/clusters 回到台式机的CMD，上传文件到服务器，这里是我自己的路径\n1 scp -r D:\\Linux\\DST_Server\\MyDediServer boomboomzd@192.168.1.31:~/dst-server/dontstarve-config/clusters 又回到服务器\n1 2 3 4 5 6 7 8 9 10 11 #可以安装一个tree工具方便查看目录结构 sudo apt install tree #文件树状图结构如下图所示 cd ~/dst-server/dontstarve-config/ tree -L 4 #cluster.ini：集群的配置 #cluster_token.txt：服务器token #Caves:洞穴相关的配置 #Master：地面相关配置 创建运行脚本并保存\n1 2 cd ~/dst-server/ sudo nano ./run_server.sh 脚本内容如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 #!/bin/bash #以下需要替换为你自己的路径 game_home=/home/boomboomzd/dst-server/dontstarve game_config_dir=/home/boomboomzd/dst-server/dontstarve-config game_log_path=/home/boomboomzd/dst-server/log shard=$1 if [[ \u0026#34;$shard\u0026#34; == \u0026#34;Master\u0026#34; ]]; then echo \u0026#34;启动地面服务器\u0026#34; elif [[ \u0026#34;$shard\u0026#34; == \u0026#34;Caves\u0026#34; ]]; then echo \u0026#34;启动洞穴服务器\u0026#34; else echo \u0026#34;输入只能是Master或者Caves\u0026#34; exit -1 fi cd \u0026#34;$game_home\u0026#34;/bin run_command=(./dontstarve_dedicated_server_nullrenderer) run_command+=(-console) run_command+=(-persistent_storage_root \u0026#34;$game_config_dir\u0026#34;) run_command+=(-conf_dir clusters) run_command+=(-cluster MyDediServer) run_command+=(-shard \u0026#34;$shard\u0026#34;) #运行日志会存储在log_Master.log和log_Caves.log文件中，可以查看日志内容 mkdir -p \u0026#34;$game_log_path\u0026#34; \u0026#34;${run_command[@]}\u0026#34; \u0026gt;\u0026#34;$game_log_path\u0026#34;/log_$shard.log 2\u0026gt;\u0026amp;1 \u0026amp; 启动服务器\n1 2 3 4 5 6 7 8 9 10 11 12 13 #将文件的所有者和组都改为你的用户（boomboomzd），刚刚sudo nano创建的文件权限属于root，普通文件操作不应该用sudo的 sudo chown boomboomzd:boomboomzd ~/dst-server/run_server.sh #添加执行权限 chmod +x run_server.sh #启动地面服务器 ./run_server.sh Master #启动洞穴服务器 ./run_server.sh Caves #应该就可以在局域网的其他设备搜到了 停止服务器\n1 2 3 4 #查看服务器进程id ps -ef| grep dontstarve #停止进程 kill 进程id 备用指令\n1 2 3 4 5 6 7 8 9 10 11 #查看饥荒服务器监听的端口 sudo ss -tulpn | grep dontstarve # 查看每个进程在哪个核心上运行 ps -eo pid,psr,pcpu,comm | grep dontstarve # 更详细的版本 for pid in $(pgrep dontstarve); do echo \u0026#34;进程 $pid 运行在核心: $(taskset -cp $pid | awk -F\u0026#39;: \u0026#39; \u0026#39;{print $2}\u0026#39;)\u0026#34; ps -p $pid -L -o tid,psr,pcpu,comm | grep -v TID done 四、公网服务器搭建 最理想的情况当然是拥有公网的IPV4地址，但不好搞，好多地方都要收费，然后就是内网穿透之类的，但也需要一定的费用租借公网服务器，还有就是IPV6，因为几乎用不完的数量，公网IPV6运营商一般还是会提供的，我最先就尝试了该方法，竟然一次性成功了。。。而且简单得离谱。。。\n1 2 3 4 5 6 #打开配置文件 cd ~/DST_Server\\MyDediServer nano cluster.ini #修改bind_ip bind_ip = :: # 两个冒号，代表监听所有IPv4和IPv6地址 #保存退出并重启服务器，然后就成功了，我的一位同学友情参与了测试，在离我四十公里远的地方直接在饥荒联机版的游戏大厅找到了我的服务器并成功进入。 指令存档 基础命令 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # 切换到用户的主目录 cd ~ # 显示当前绝对路径 pwd # 创建文件夹 mkdir 目录名 #当前目录创建 mkdir -p 含路径 #递归创建，没有的父目录也能创建 # 删除文件夹 rmdir 目录名 #当前目录删除 #新建文件 touch 文件名 #终止进程 pkill 进程名 pkill -f 进程名 #终止所有命令行中含有该进程的进程 #权限操作 chmod [选项] 权限模式 文件... chmod [选项] --reference=参考文件 文件... chmod +x 文件 #添加执行权限 CPU温度读取 1 2 3 4 5 6 7 8 9 10 # 查看所有温度区域 cat /sys/class/thermal/thermal_zone*/temp # 查看具体的温度（需要除以1000得到摄氏度） cat /sys/class/thermal/thermal_zone0/temp # 更友好的查看方式 for i in /sys/class/thermal/thermal_zone*/temp; do echo \u0026#34;Zone $(basename $(dirname $i)): $(cat $i | awk \u0026#39;{print $1/1000}\u0026#39;)°C\u0026#34;; done 用户信息操作 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # 查看当前登录用户 who whoami # 当前用户 users # 所有登录用户 # 显示更详细的信息 w # 显示谁在登录及在做什么 last # 显示登录历史 lastlog # 显示所有用户最近登录时间 # 查看系统账户（UID \u0026lt; 1000） awk -F: \u0026#39;$3 \u0026lt; 1000 {print $1}\u0026#39; /etc/passwd # 查看普通用户（UID \u0026gt;= 1000） awk -F: \u0026#39;$3 \u0026gt;= 1000 {print $1}\u0026#39; /etc/passwd # 查看可登录用户（有有效shell） grep -v \u0026#34;/nologin\\|/false\u0026#34; /etc/passwd | cut -d: -f1 # 查看密码策略 chage -l 用户名 # 显示密码过期信息 # 查看sudo权限 sudo -l -U 用户名 # 查看用户的sudo权限 # 统计用户数量 wc -l /etc/passwd APT操作 1 2 3 4 5 6 7 8 9 10 11 #查看所有通过apt安装的包,支持用 grep 过滤，如 apt list --installed | grep steam apt list --installed #更新 sudo apt-get update #安装 sudo apt-get -y install xxxA xxxB xxxC #查看所有活动的软件源 apt policy ","date":"2026-01-24T15:59:09+08:00","permalink":"https://Boomboomzd.github.io/p/%E9%A5%A5%E8%8D%92%E8%81%94%E6%9C%BA%E7%89%88%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/","title":"饥荒联机版服务器搭建"},{"content":"2026/1/24：博客之始 折腾一番总算是搭建好了博客网站，采用的主流的Hugo+git全免费方案，虽然域名比较固定，但免费的就是香啊，我的博客终于可以开始写了，“千里之行，始于足下”，希望我能坚持下去，等记录多了就买个域名奖励自己。\n在这历史性的时刻，我决定开始写博客的第一天，当然少不了亿点点碎碎念。\n转眼已快25岁，在这四分之一到三分之一的人生中，除了吃饭睡觉等满足生命体征必需的每日活动外，似乎并没有什么一直在坚持做的事情，虽然快乐自由，但总觉得自己应该找一件事情长久地做下去，不用定什么目标，只要做就行了。思来想去，脑袋里冒出的想法倒是不少，但在未来几十年这个巨大的时空跨度下，都显得有些渺小，灵光一闪之间，我想到了写博客，不管我未来几十年干了什么，我都可以通过博客记录下来，不用担心什么计划，将博客长久地做下去就行了。\n第一个项目，也是我写博客想法起源之一，那就是搭建饥荒联机版服务器！作为本科期间玩了一千多个小时的游戏，想拥有一个自己的服务器不是很自然的想法吗？也许，我能创造出真正的永恒大陆。\n2026/1/25：\n今天给新买的迷你主机重装Ubuntu Server了，不得不说现在这些免费开源的系统和软件做得太牛逼了，详细的文档，丰富的教程，竟然全是免费开源的东西，我这第一次装陌生的系统竟然没遇到什么问题。看着自己台式主机成功通过SSH远程访问到迷你主机还是蛮有成就感的。\n","date":"2026-01-24T12:24:27+08:00","permalink":"https://Boomboomzd.github.io/p/%E5%BF%83%E6%83%85%E9%9A%8F%E7%AC%94/","title":"心情随笔"}]